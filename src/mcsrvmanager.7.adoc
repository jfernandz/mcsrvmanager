= mcsrvmanager(7)
:doctype: manpage
:manmanual: mcsrvmanager Manual
:mansource: mcsrvmanager 0.1.0

== NAME

mcsrvmanager - systemd and tmux based Minecraft server instance manager with scheduled backups

== DESCRIPTION

mcsrvmanager provides templated systemd units and helper scripts to run one or more
Minecraft servers as named instances.

Each instance:

- runs in its own tmux session
- is controlled by `mc@<instance>.service`
- can be backed up via `mc-backup@<instance>.service`
- can be scheduled via `mc-backup@<instance>.timer`

Backups are created with 7-Zip and exclude dynmap tile data (`dynmap/web`) by default.

== UNITS

`mc@.service`::
Starts and stops a Minecraft instance in a tmux session.

`mc-backup@.service`::
One-shot job: stop instance, backup files, start instance.

`mc-backup@.timer`::
Calendar timer triggering `mc-backup@<instance>.service`.

== CONFIGURATION

Configuration is read from environment files:

- `/etc/default/mc/common.env` (shared defaults)
- `/etc/default/mc/<instance>.env` (instance-specific)

Important per-instance keys:

`MC_SERVER_DIR`::
Required. Server directory containing world data and server jar.

`MC_JAR_NAME`::
Required. Jar file name inside `MC_SERVER_DIR`.

`MC_JAVA_BIN`::
Java executable path. Default: `/usr/bin/java`.

`MC_XMX`, `MC_XMS`::
JVM heap settings. Default: `4G`.

`MC_TMUX_SESSION`::
tmux session name. Default: `mc-<instance>`.

`MC_STOP_COMMAND`::
Command sent to server console on stop. Default: `stop`.

`MC_STOP_TIMEOUT`::
Seconds to wait for graceful stop before force-killing tmux session.

`MC_BACKUP_DIR`::
Required. Output directory for backup archives.

`MC_BACKUP_PREFIX`::
Archive filename prefix. Default: instance name.

`MC_BACKUP_LEVEL`::
7z compression level. Default: `3`.

`MC_BACKUP_RETENTION_DAYS`::
Delete backup archives older than this value. Default: `14`.

`MC_BACKUP_EXCLUDES`::
Optional extra 7z exclude patterns (space-separated).

== EXAMPLES

Enable and start one instance named `fabri_kmz`:

----
systemctl enable --now mc@fabri_kmz.service
systemctl enable --now mc-backup@fabri_kmz.timer
----

Run backup immediately:

----
systemctl start mc-backup@fabri_kmz.service
----

Attach to the instance console:

----
tmux attach -t mc-fabri_kmz
----

== BACKUP WORKFLOW

`mc-backup@<instance>.service` executes `mc-backup.sh`, which performs:

. `systemctl stop mc@<instance>.service`
. archive server directory with 7z
. exclude dynmap tile paths (`dynmap/web`)
. delete expired archives by retention policy
. `systemctl start mc@<instance>.service`

== FILES

`/usr/lib/systemd/system/mc@.service`

`/usr/lib/systemd/system/mc-backup@.service`

`/usr/lib/systemd/system/mc-backup@.timer`

`/usr/bin/mc-tmux-start.sh`

`/usr/bin/mc-tmux-stop.sh`

`/usr/bin/mc-backup.sh`

`/etc/default/mc/common.env`

`/etc/default/mc/<instance>.env`

`/usr/share/doc/mcsrvmanager/examples/mc-common.env.example`

`/usr/share/doc/mcsrvmanager/examples/mc-instance.env.example`

== SEE ALSO

systemd(1), systemd.service(5), systemd.timer(5), tmux(1), 7z(1), java(1)
